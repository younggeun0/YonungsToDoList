<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Young's To Do List</title>
<style type="text/css">
	#wrap {
		width:300px;
		margin:0px auto;
	}
	
	#top,#bottom {
		width:300px;
		height:400px;
		float:left;
		margin:0px auto;
		text-align: center;
	}
	
	#bottom {
		border-top: 1px solid #333;
	}
	
	#todoTab, #finTab {
		width:300px;
	}
	
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript">
	var ls = window.localStorage;
	var tdCnt = 0;
	var finCnt = 0;

	$(function() {
		
		setLsData();
		
		$("#addBtn").click(function() {
			toDo = $("#todo").val().trim();
			
			if(toDo == "") {
				alert("할 일을 입력해주세요.");
				$("#todo").focus();
				return;
			}
			
			if ($("#todoTab tr").length > 4) {
				alert("할  일은 5개까지만 추가 가능합니다.\n기존 일들을 완료 후 추가해주세요.");
				return;
			}
			
			var tdCode = getTdCode();
			$("#todoTab:last").append("<tr id='"+tdCode+"' name='tdTr'><td width='50'><input type='checkbox' value='"+toDo+"'></td><td width='200'>"
					+toDo+"</td><td width='50'><a href='#void' onclick='removeLs(\""+tdCode+"\")'>-</a></td></tr>");
			
			ls.setItem(tdCode,toDo);
		});
		
		$("#todoTab").click(function(){
			$.each($("[name='tdTr'] input"),function(idx, cb){
				if ($(cb).is(":checked")){
					
					var finCode = getFinCode();
					var date = new Date();
					var value = $(cb).val()+" "+((date.getFullYear()-2000)+"-"+(date.getMonth()+1)+"-"+date.getDate());
					$("#finTab:last").append("<tr id='"+finCode+"'><td width='280'>"+value
							+"</td><td width='20'><a href='#void'onclick='removeLs(\""+finCode+"\")'>-</a></td></tr>");;
					ls.removeItem($(cb).parent().parent().attr("id"));
					tdCnt--;
					ls.setItem("tdCnt",tdCnt);
					$(cb).parent().parent().remove();
					ls.setItem(finCode,value);
				}
			});
		});
	});
	
	function getTdCode() {
		ls.setItem("tdCnt",(tdCnt+1));
		return "td-"+tdCnt++;
	}
	
	function getFinCode() {
		ls.setItem("finCnt",(finCnt+1));
		return "fin-"+finCnt++;
	}
	
	function setLsData() {
		tdCnt = ls.getItem("tdCnt");
		finCnt = ls.getItem("finCnt");
		
		console.log(tdCnt);
		console.log(finCnt);
		
		var tdCode = "";
		var tdVal = "";
		for(var i=0; i<(tdCnt+finCnt); i++) {
			tdCode = "td-"+i;
			tdVal = ls.getItem(tdCode);
			
			if (tdVal != null) {
				$("#todoTab:last").append("<tr id='"+tdCode+"' name='tdTr'><td width='50'><input type='checkbox' value='"+tdVal
						+"'></td><td width='200'>"
						+tdVal+"</td><td width='50'><a href='#void' onclick='removeLs(\""+tdCode+"\")'>-</a></td></tr>");
			}
		}
		
		var finCode = "";
		var finVal = "";
		for(var i=0; i<(tdCnt+finCnt); i++) {
			finCode = "fin-"+i;
			finVal = ls.getItem(finCode);
			
			if (finVal != null) {
				$("#finTab:last").append("<tr id='"+finCode+"'><td width='280'>"
						+finVal+"</td><td width='20'><a href='#void' onclick='removeLs(\""+finCode+"\")'>-</a></td></tr>");
			}
		}
	}
	
	function removeLs(key) {
		
		if(key.includes("td")) {
			tdCnt--;
			ls.setItem("tdCnt",tdCnt);
		} else {
			finCnt--;
			ls.setItem("finCnt",finCnt);
		}
		
		var target = "#"+key;
		localStorage.removeItem(key);
		$(target).remove();
	}
</script>
</head>
<body>
<div id=wrap>
	<div id="top">
		<h3>Young's To Do List</h3>
		<form name="todoFrm">
			<input type="text" id="todo"><input type="button" value="add" id="addBtn">
		</form>
		<br/>
		<h4>남은 일</h4>
		<table id="todoTab"></table>
	</div>
	<div id="bottom">
		<h4>끝낸 일</h4>
		<table id="finTab"></table>
	</div>
</div>
</body>
</html>